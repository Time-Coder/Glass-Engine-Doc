<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>场景图 &mdash; Glass Engine 0.0.1 文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/glass_engine_logo32.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="空间变换" href="../transform/transform.html" />
    <link rel="prev" title="开始" href="../getting_start/getting_start.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Glass Engine
              <img src="../_static/glass_engine_logo64.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduce/introduce.html">介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_start/getting_start.html">开始</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">场景图</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">场景图</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">场景节点</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../transform/transform.html">空间变换</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/background.html">背景</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geometries/geometries.html">基本几何体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/model.html">模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../color_renderhint/color_renderhint.html">颜色与渲染提示</a></li>
<li class="toctree-l1"><a class="reference internal" href="../material/material.html">材质</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lights/lights.html">光源</a></li>
<li class="toctree-l1"><a class="reference internal" href="../camera/camera.html">相机</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fog/fog.html">雾</a></li>
<li class="toctree-l1"><a class="reference internal" href="../post_process_effects/post_process_effects.html">后处理效果</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manipulators/manipulators.html">键鼠交互</a></li>
<li class="toctree-l1"><a class="reference internal" href="../renderers/renderers.html">渲染器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../animation/animation.html">动画</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Glass Engine</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">场景图</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/scene_graph/scene_graph.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="label-scene-graph">
<span id="id1"></span><h1>场景图<a class="headerlink" href="#label-scene-graph" title="此标题的永久链接"></a></h1>
<section id="id2">
<h2>场景图<a class="headerlink" href="#id2" title="此标题的永久链接"></a></h2>
<p><strong>Glass Engine</strong> 是按照 <strong>场景图</strong> 的理念对场景进行组织的。当我们需要构建复杂场景时，利用场景图的方式更容易描述场景中对象的位置姿态等变换。例如，想象一下，我们要创建这样一个场景：地面上坐落一个房子，房子里放着一张桌子，一把椅子，桌子上放着一个杯子，一个茶壶。很显然，从生活逻辑上讲，这个场景遵循图 1 所示的层次关系：</p>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../_images/scene_graph.png"><img alt="场景图" src="../_images/scene_graph.png" style="width: 243.29999999999998px; height: 183.0px;" /></a>
<figcaption>
<p><span class="caption-text">图 1. 房子、桌椅、杯子、茶壶所构成的场景图</span><a class="headerlink" href="#id4" title="此图像的永久链接"></a></p>
</figcaption>
</figure>
<p>从另一方面讲，当我们描述房子位置的时候，以世界坐标描述比较方便；当我们描述桌子位置的时候，是不是以房子为参考系描述比较方便？当我们描述杯子位置的时候，是不是以桌子为参考系描述比较方便？因此，以树状结构组织场景，能够更符合直觉的体现对象之间的从属关系，并且更加便于描述场景中对象的空间变换。再抽象一层，在上图所示的场景树状结构中，一个节点实际上是代表了一个局部坐标系，它的子节点的空间变换描述是相对于该父节点所代表的的局部坐标系的。按照局部坐标系的理念，则不难理解，如果父节点移动，其所有子节点会跟着移动，但会保持相对父节点的相对坐标不变，这也是将场景组织成树状结构的优势所在。</p>
<p>既然将场景组织成树状结构，为什么不叫场景树而叫场景图呢？是因为，在 <strong>Glass Engine</strong> 的设计中，一个场景节点可以有多个父节点，如图 2 所示。该图表示，桌子上和椅子上放了两个一模一样的茶壶。</p>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../_images/scene_graph2.png"><img alt="场景图2" src="../_images/scene_graph2.png" style="width: 244.79999999999998px; height: 183.9px;" /></a>
<figcaption>
<p><span class="caption-text">图 2. 多父节点的场景图</span><a class="headerlink" href="#id5" title="此图像的永久链接"></a></p>
</figcaption>
</figure>
<p>当我们需要在不同位置绘制同一个物体时，推荐使用将该物体挂载到多个父节点上的方式。因为采取这种方式时，在 <strong>Glass Engine</strong> 内部处理时，既可以避免重复的相同物体顶点创建过程，还采用了 <strong>实例化</strong> 渲染方式，将物体在不同位置的绘制合并为一次渲染调用，加快了渲染速度。因此，在这种情况下，场景的组织方式是图而不是树了。更确切的说，这种组织方式是有向无环图。因此，称这种组织方式为 <strong>场景图</strong>。</p>
<p>在 <strong>Glass Engine</strong> 中，首先由 <code class="docutils literal notranslate"><span class="pre">scene</span> <span class="pre">=</span> <span class="pre">Scene()</span></code> 创建出一个场景，一个场景对应唯一一个场景图，一个场景图含有唯一一个根节点，可通过 <code class="docutils literal notranslate"><span class="pre">scene.root</span></code> 访问到。往场景中添加对象都应该直接或间接的挂载到根节点上。挂载节点的方式为：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">SceneNode</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
<p>上述代码利用 <code class="docutils literal notranslate"><span class="pre">SceneNode</span></code> 创建了一个抽象场景节点 <code class="docutils literal notranslate"><span class="pre">node</span></code>，并将该节点挂载到场景的根节点上。由于往根节点上挂载节点的操作会比较频繁，<strong>Glass Engine</strong> 将该操作进行了一个简化，使得上述代码与下面的代码等价：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">SceneNode</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
<p>注意，这种简化写法只能用于往场景根节点上挂载节点。这里的抽象节点 <code class="docutils literal notranslate"><span class="pre">node</span></code> 并不是一个可绘制对象，仅仅代表一个局部坐标系（如果不好理解的话，你可以暂时理解为一个空间位置）。我们可以设置 <code class="docutils literal notranslate"><span class="pre">node</span></code> 的空间变换：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">node</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># 偏航角 30 度</span>
</pre></div>
</div>
<p>随后 <code class="docutils literal notranslate"><span class="pre">node</span></code> 下直接和间接挂载的所有子节点将与该节点一起做了这个空间变换，但会保持与该节点的相对位置不变。</p>
<p>下面我们来看一个例子：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">glass_engine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">glass_engine.Geometries</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">scene</span><span class="p">,</span> <span class="n">camera</span><span class="p">,</span> <span class="n">dir_light</span><span class="p">,</span> <span class="n">floor</span> <span class="o">=</span> <span class="n">SceneRoam</span><span class="p">()</span> <span class="c1"># 创建基础场景</span>

<span class="n">node1</span> <span class="o">=</span> <span class="n">SceneNode</span><span class="p">()</span> <span class="c1"># 创建一个场景节点</span>
<span class="n">node1</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># 设置节点位置的 x 坐标为 -1</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span> <span class="c1"># 将其挂载到场景根节点上</span>

<span class="n">node2</span> <span class="o">=</span> <span class="n">SceneNode</span><span class="p">()</span> <span class="c1"># 创建另一个场景节点</span>
<span class="n">node2</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># 设置节点位置的 x 坐标为 1</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span> <span class="c1"># 将其挂载到场景根节点上</span>

<span class="n">cone</span> <span class="o">=</span> <span class="n">Cone</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># 创建一个圆锥模型</span>
<span class="n">cone</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="c1"># 设置圆锥位置的 x 坐标为 -0.5</span>
<span class="n">node1</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">cone</span><span class="p">)</span> <span class="c1"># 将圆锥挂载到 node1 上</span>
<span class="n">node2</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">cone</span><span class="p">)</span> <span class="c1"># 同时，将圆锥挂载到 node2 上</span>

<span class="n">cylinder</span> <span class="o">=</span> <span class="n">Cylinder</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># 创建一个圆柱模型</span>
<span class="n">cylinder</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># 设置圆柱位置的 x 坐标为 1</span>
<span class="n">node2</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">cylinder</span><span class="p">)</span> <span class="c1"># 将圆柱挂载到 node2 上</span>

<span class="n">camera</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>这段代码将产生如图 3 所示的结果：</p>
<figure class="align-center" id="id6">
<a class="reference internal image-reference" href="../_images/cone_cylinder.png"><img alt="圆锥圆柱" src="../_images/cone_cylinder.png" style="width: 398.8px; height: 286.8px;" /></a>
<figcaption>
<p><span class="caption-text">图 3. 圆锥圆柱所构成的场景</span><a class="headerlink" href="#id6" title="此图像的永久链接"></a></p>
</figcaption>
</figure>
<p>上述代码创建了一个如图 4 所示的场景图：</p>
<figure class="align-center" id="id7">
<a class="reference internal image-reference" href="../_images/scene_graph3.png"><img alt="圆锥圆柱场景图" src="../_images/scene_graph3.png" style="width: 420.9px; height: 197.7px;" /></a>
<figcaption>
<p><span class="caption-text">图 4. 圆锥圆柱所构成的场景图</span><a class="headerlink" href="#id7" title="此图像的永久链接"></a></p>
</figcaption>
</figure>
<p><code class="docutils literal notranslate"><span class="pre">cone</span></code> 节点同时挂载到了两个节点 <code class="docutils literal notranslate"><span class="pre">node1</span></code> 和 <code class="docutils literal notranslate"><span class="pre">node2</span></code> 下，因此圆锥出现在了两个不同的位置。而我们设置 <code class="docutils literal notranslate"><span class="pre">cylinder</span></code> 节点的位置 x 坐标为 1，实则为相对 <code class="docutils literal notranslate"><span class="pre">node2</span></code> 的相对坐标，因此其不会和 <code class="docutils literal notranslate"><span class="pre">node2</span></code> 下的圆锥重合。这个例子是对场景图概念的一个很好的示意。</p>
</section>
<section id="id3">
<h2>场景节点<a class="headerlink" href="#id3" title="此标题的永久链接"></a></h2>
<p>在上面的例子中，<code class="docutils literal notranslate"><span class="pre">Camera</span></code>、<code class="docutils literal notranslate"><span class="pre">DirLight</span></code>、<code class="docutils literal notranslate"><span class="pre">Floor</span></code>、<code class="docutils literal notranslate"><span class="pre">Sphere</span></code>、<code class="docutils literal notranslate"><span class="pre">Cone</span></code>、<code class="docutils literal notranslate"><span class="pre">Cylinder</span></code>、<code class="docutils literal notranslate"><span class="pre">SceneNode</span></code> 均能作为场景节点并组织成场景图，原因是这些类均继承自 <code class="docutils literal notranslate"><span class="pre">SceneNode</span></code>。以 <code class="docutils literal notranslate"><span class="pre">SceneNode</span></code> 为根类的所有类的继承关系如图 5 所示：</p>
<figure class="align-center" id="id8">
<a class="reference internal image-reference" href="../_images/scenenode_class_graph.png"><img alt="场景节点类图" src="../_images/scenenode_class_graph.png" style="width: 699.6px; height: 274.8px;" /></a>
<figcaption>
<p><span class="caption-text">图 5. 场景节点继承关系图</span><a class="headerlink" href="#id8" title="此图像的永久链接"></a></p>
</figcaption>
</figure>
<p>其中：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SceneNode</span></code> 为 <strong>场景节点</strong>，是所有场景节点类的基类。可将其想象为一个局部坐标系，可用 <code class="docutils literal notranslate"><span class="pre">position,</span> <span class="pre">yaw,</span> <span class="pre">pitch,</span> <span class="pre">roll,</span> <span class="pre">orientation</span></code> 等属性描述该局部坐标系相对于其父节点的空间变换关系。可用 <code class="docutils literal notranslate"><span class="pre">add_child,</span> <span class="pre">remove_child</span></code> 添加或删除子节点。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SinglePathNode</span></code> 为 <strong>单路径节点</strong>。单路径指的是从该节点出发向上追溯到根节点的路径是唯一的。<strong>Glass Engine</strong> 通过异常和其他机制保证了这种唯一性，一般情况下你不需要创建它，它只作为相机类的父类存在。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Camera</span></code> 为 <a class="reference internal" href="../camera/camera.html#label-camera"><span class="std std-ref">相机</span></a>，用于将场景投影为屏幕上显示的视图，其显示屏 <code class="docutils literal notranslate"><span class="pre">screen</span></code> 属性即为 3D 视口，可作为一个 GUI 控件（当前仅为 <cite>QWidget</cite>）布局到程序界面的任意位置，也可单独显示。在不设置姿态时，相机视线方向朝向其所在的局部坐标系 y 轴正方向。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Light</span></code> 为 <a class="reference internal" href="../lights/lights.html#label-lights"><span class="std std-ref">光源</span></a>，用于照亮场景。建议场景中至少添加一个光源，否则整个场景将一片漆黑。请不要用 <code class="docutils literal notranslate"><span class="pre">Light</span></code> 类直接创建实例，因为这将起不到任何光源的作用。而应该用其子类创建光源实例。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DirLight</span></code> 为 <a class="reference internal" href="../lights/lights.html#label-dirlight"><span class="std std-ref">平行光</span></a>，范围无限大，能照亮全场。其有一个特定的光线方向，在不设置姿态时朝向其所在的局部坐标系 y 轴正方向。可用姿态属性 <code class="docutils literal notranslate"><span class="pre">yaw,</span> <span class="pre">pitch,</span> <span class="pre">roll,</span> <span class="pre">orientaion</span></code> 控制光线方向，而其位置属性 <code class="docutils literal notranslate"><span class="pre">position</span></code> 则没有意义。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PointLight</span></code> 为 <a class="reference internal" href="../lights/lights.html#label-pointlight"><span class="std std-ref">点光源</span></a>，光线从一点发散射出，具有一定的照明范围。其发出的光线具有各向同性，所以其姿态属性无意义。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SpotLight</span></code> 为 <a class="reference internal" href="../lights/lights.html#label-spotlight"><span class="std std-ref">聚光</span></a>，类似于舞台聚光灯。聚光仅射出一个光锥，光锥内表现为点光源，光锥外不被照亮。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Mesh</span></code> 为 <strong>网格</strong>，“网格”这个名字不太直观，事实上就是场景中可见的实体，并且不可再分。之所以起名为网格是因为这是计算机图形学中的通用术语。所有的基本几何体都继承自 <code class="docutils literal notranslate"><span class="pre">Mesh</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Floor</span></code> 为 <strong>地板</strong>，基本几何体之一，可直接作为场景的地面使用。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Sphere,</span> <span class="pre">Cone,</span> <span class="pre">Cylinder,</span> <span class="pre">...</span></code> 为各种 <a class="reference internal" href="../geometries/geometries.html#label-geometries"><span class="std std-ref">基本几何体</span></a>，<strong>Glass Engine</strong> 提供 40 多种基本几何体，详情见 <a class="reference internal" href="../geometries/geometries.html#label-geometries"><span class="std std-ref">基本几何体</span></a>，不在此一一介绍。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Model</span></code> 为 <a class="reference internal" href="../model/model.html#label-model"><span class="std std-ref">模型</span></a>，单指从外部模型文件加载上来的模型。可直接通过 <code class="docutils literal notranslate"><span class="pre">Model(&quot;file_name&quot;)</span></code> 的方式直接从文件加载模型。<strong>Glass Engine</strong> 支持 40 多种格式的模型文件加载，详情见 <a class="reference internal" href="../model/model.html#label-model"><span class="std std-ref">模型</span></a>，不在此一一介绍。</p></li>
</ul>
<p>一个基类场景节点 <code class="docutils literal notranslate"><span class="pre">SceneNode</span></code> 对象是可以被独立创建的，场景节点基类对象仅代表一个局部坐标系，并维持树状结构关系。在上面的描述中，我们经常提到局部坐标系的概念，而所有的空间变换描述都依赖于局部坐标系的定义，在下一节中我们将给出定义并详细讲解空间变换的概念。</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="../getting_start/getting_start.html" class="btn btn-neutral float-left" title="开始" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../transform/transform.html" class="btn btn-neutral float-right" title="空间变换" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2023, 王炳辉.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>